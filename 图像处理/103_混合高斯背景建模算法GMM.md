## 高斯混合模型介绍

高斯混合模型（Gaussian Mixture Model）通常简称GMM，是一种业界广泛使用的聚类算法，该方法使用了高斯分布作为参数模型，并使用了**期望最大（Expectation Maximization，简称EM）**算法进行训练。

混合高斯背景建模是**基于像素样本统计信息**的背景表示方法。

对于视频图像中的每一个像素点，其值在序列图像中的变化可看作是不断产生像素值的随机过程，可以用**高斯分布来模拟像素值的变化规律**。由于混合高斯模型理论上可以拟合任何一种分布，所以用GMM建模效果较好。

图像的每一个像素点按**不同权值的多个高斯分布**的叠加来建模，各个高斯分布的权值和分布参数随时间更新。

GMM的参数包括：高斯混合系数、均值、方差

## 背景提取流程

与标准的GMM聚类过程有所区别：聚类参考《机器学习\29_k-means和GMM的区别与联系.md》

1. 为图像中的每个像素点，==初始化一个高斯混合模型==的参数。K个高斯模型，各有三个参数：高斯混合系数$w$、均值$\mu$、方差$\sigma^2$。

2. 计算新像素值$X_t$是否==属于第$k$个高斯分布==（属于即视为匹配成功，可存在多组匹配成功）。判断方法：其与高斯模型的均值偏差在$2.5\sigma$内。

   <img src="https://pic4.zhimg.com/80/v2-9ec3db09fa3c6cab496f87253864783b_720w.jpg" style="zoom:80%;" />

3. 如果存在匹配成功的高斯分布，那么该像素值就属于背景，否则为前景。

4. ==更新高斯混合系数$w$==，其中$\alpha$为学习率。对于匹配的模式$M_k,t=1,$否则$M_k,t=0$。

   <img src="https://pic1.zhimg.com/80/v2-aa894fdebe0f95eaf8f15dedef8280c4_720w.jpg" style="zoom:80%;" />

   上面公式的含义：对于匹配成功的高斯分布，加大其系数，因为该分布更能反映背景像素分布；对于匹配失败的高斯分布，减少其系数，说明该高斯分布已经不能准确表达背景信息了。

   ==更新以后需要重新对$w$归一化，确保混合高斯分布的最大值为1==

5. 未匹配成功的高斯模型不做更新，匹配成功的高斯模型根据$X_t$更新参数$\mu$和$\sigma^2$。
   $$
   \begin{aligned}
   E步：&固定\mu和\sigma，计算属于每一类的概率\\
   \rho&=w_{k,t}*\eta\left(X_{t} \mid \mu_{k}, \sigma_{k}\right) \\
   M步：&固定\rho，更新\mu和\sigma\\
   \mu_{t}&=(1-\rho) * \mu_{t-1}+\rho^{*} X_{t} \\
   \sigma_{t}^{2}&=(1-\rho)^{*} \sigma_{t-1}^{2}+\rho^{*}\left(X_{t}-\mu_{t}\right)^{T}\left(X_{t}-\mu_{t}\right)
   \end{aligned}
   $$
   $\rho$为当前数据**属于某个高斯分布的概率**，利用该概率进行滑动平均更新均值和方差。

6. 如果不存在匹配成功的高斯模型，即该点为前景，就直接==去除$w$最小的高斯模型==，然后==添加一个新的高斯模型==，其均值为$X_t$，**标准差初始化为较大的值**，**高斯混合系数$w$初始化为较小的值**。

   此时高斯模型的总数是不变的。

7. 各模式根据$w/{\sigma ^2}$按降序排列，**权重大、标准差小**的模式排列在前。

8. 选前B个模式作为背景，B满足下式，参数T表示背景所占的比例：

   <img src="https://pic2.zhimg.com/80/v2-f688c3272776a0b787f1293dd4badba1_720w.jpg" alt="img" style="zoom:67%;" />

   ==7、8的主要目的是：防止刚加入的前景立刻作为背景模板，这样下一帧的该位置会立马变成背景，前景检测就不稳定了；该步骤保证了当新加入的高斯模型在更新了一次次数后才加入背景模板，保证了背景的稳定性，同时也具有背景适应环境变化的特点==

   ------

**与GMM聚类的区别在于：**

1. 聚类需要利用所有的样本更新。背景提取需要一个样本更新。
2. 聚类需要计算每个样本属于每个高斯分布的概率。背景提取只需要判断新的点属于哪个高斯分布即可。
3. 聚类不需要学习率来更新高斯混合系数。背景提取需要学习率单独更新混合系数。
4. 聚类利用所有的样本更新每一个高斯分布。背景提取只用新样本更新匹配成功的高斯模型。
5. 聚类不会剔除高斯模型，只会不断更新每一个高斯模型。背景提取会逐步剔除混合系数最小的分布，然后生成新的高斯模型加入GMM，正因如此，==GMM可以适应缓慢的光线变化==。

## 参考

参考链接：[基于opencv的运动目标检测](https://zhuanlan.zhihu.com/p/34392916)——去除了最后两步，主要是因为没看懂